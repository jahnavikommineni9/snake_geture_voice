<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Voice-Controlled Snake</title>
<style>
  body{font-family:system-ui,Segoe UI,Arial;display:flex;gap:20px;align-items:flex-start;padding:18px;background:#0b1220;color:#e6eef8}
  #container{display:flex;flex-direction:column;gap:12px}
  canvas{background:#000;border-radius:6px;border:4px solid #222}
  #controls{display:flex;gap:8px;align-items:center}
  button{padding:10px 12px;border-radius:8px;border:none;background:#1963a6;color:#fff;font-weight:600;cursor:pointer}
  .red{background:#c53030}
  #status{font-size:14px;color:#bcd;min-width:260px}
  #transcript{background:#071424;color:#9fd;padding:8px;border-radius:6px;min-width:260px;height:80px;overflow:auto}
</style>
</head>
<body>
<div id="container">
  <canvas id="game" width="400" height="400"></canvas>
  <div id="controls">
    <button id="micBtn">Start Mic</button>
    <button id="startGame">Start Game</button>
    <button id="pauseGame">Pause</button>
    <div id="status">Mic: stopped • Last command: —</div>
  </div>
  <div id="transcript"></div>
</div>

<script>
/* ---------- GAME CORE ---------- */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const GRID=20, CELL=20, COLS=canvas.width/CELL, ROWS=canvas.height/CELL;
let snake=[{x:Math.floor(COLS/2), y:Math.floor(ROWS/2)}];
let dir={x:1,y:0};
let food=randomFood();
let running=false, paused=false, score=0, speed=8, lastTick=0;
function randomFood(){ while(true){ const f={x:Math.floor(Math.random()*COLS), y:Math.floor(Math.random()*ROWS)}; if(!snake.some(s=>s.x===f.x&&s.y===f.y)) return f; } }
function tick(){
  if(!running || paused) return;
  const head={x:(snake[0].x+dir.x+COLS)%COLS, y:(snake[0].y+dir.y+ROWS)%ROWS};
  if(snake.some(s=>s.x===head.x && s.y===head.y)){ running=false; return; }
  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){ score++; food=randomFood(); speed=Math.min(16, 6+Math.floor(score/3)+2); } else snake.pop();
}
function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#e33"; ctx.fillRect(food.x*CELL, food.y*CELL, CELL-1, CELL-1);
  ctx.fillStyle="#6cf"; snake.forEach((p,i)=>ctx.fillRect(p.x*CELL, p.y*CELL, CELL-1, CELL-1));
  ctx.fillStyle="#fff"; ctx.font="14px monospace"; ctx.fillText("Score: "+score, 8, 16);
  if(!running){ ctx.fillStyle="rgba(0,0,0,0.6)"; if(score>0){ ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle="#fff"; ctx.font="26px monospace"; ctx.fillText("GAME OVER", 110,200); ctx.font="16px monospace"; ctx.fillText("Click Start Game to play", 90,230); } }
}
function gameLoop(ts){
  if(!lastTick) lastTick = ts;
  const interval = 1000 / speed;
  if(ts - lastTick >= interval){ tick(); lastTick = ts; }
  draw();
  requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);

/* ---------- VOICE CONTROL (Web Speech API) ---------- */
const micBtn=document.getElementById('micBtn'), statusEl=document.getElementById('status'), transcriptEl=document.getElementById('transcript');
let recognition=null, listening=false;

// cross-browser support
window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
if(!window.SpeechRecognition){
  statusEl.textContent = "Mic: not supported in this browser. Use Chrome.";
  micBtn.disabled=true;
} else {
  recognition = new window.SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = true;
  recognition.continuous = true;
  recognition.maxAlternatives = 1;

  recognition.onstart = ()=>{ listening = true; micBtn.textContent = "Stop Mic"; statusEl.textContent = "Mic: listening"; }
  recognition.onend = ()=>{ listening = false; micBtn.textContent = "Start Mic"; statusEl.textContent = "Mic: stopped"; }
  recognition.onerror = (e)=>{ console.error(e); statusEl.textContent = "Mic error: "+e.error; }

  recognition.onresult = (ev)=>{
    // show transcript
    let full = '';
    for(let i = 0; i < ev.results.length; ++i){ full += ev.results[i][0].transcript + (ev.results[i].isFinal? ' ':''); }
    transcriptEl.textContent = full;
    // when final result appears, parse for commands
    const last = ev.results[ev.results.length-1];
    if(last.isFinal){ const txt = last[0].transcript.trim().toLowerCase(); handleVoiceCommand(txt); }
  };
}

micBtn.addEventListener('click', ()=>{ if(!recognition) return; if(!listening){ try{ recognition.start(); } catch(e){} } else recognition.stop(); });

function handleVoiceCommand(text){
  statusEl.textContent = "Mic: listening • Last command: "+text;
  // accept phrases that contain keywords
  if(text.includes('left')) changeDir(-1,0);
  else if(text.includes('right')) changeDir(1,0);
  else if(text.includes('up')) changeDir(0,-1);
  else if(text.includes('down')) changeDir(0,1);
  else if(text.includes('start') || text.includes('play') || text.includes('resume')) { running = true; paused=false; }
  else if(text.includes('pause') || text.includes('stop')) { paused = true; }
  else if(text.includes('restart') || text.includes('reset') || text.includes('new game')) { resetGame(); running=true; paused=false; }
}

function changeDir(x,y){
  // prevent 180 degree reversal
  if(x === -dir.x && y === -dir.y) return;
  dir = {x:x,y:y};
}

function resetGame(){
  snake = [{x:Math.floor(COLS/2), y:Math.floor(ROWS/2)}];
  dir = {x:1,y:0};
  food = randomFood();
  score = 0; speed = 8; running = true; paused = false;
}

/* ---------- UI Buttons ---------- */
document.getElementById('startGame').addEventListener('click', ()=>{ running=true; paused=false; });
document.getElementById('pauseGame').addEventListener('click', ()=>{ paused=!paused; });

/* ---------- keyboard fallback ---------- */
window.addEventListener('keydown', e=>{
  if(e.key==='ArrowUp' && dir.y!==1) changeDir(0,-1);
  if(e.key==='ArrowDown' && dir.y!==-1) changeDir(0,1);
  if(e.key==='ArrowLeft' && dir.x!==1) changeDir(-1,0);
  if(e.key==='ArrowRight' && dir.x!==-1) changeDir(1,0);
});
</script>
</body>
</html>
